# MySQLチューニング

まず、最初にMySQLに限らず、負荷対策やチューニングするときは現在の状態を確認すること。
`推測するな、計測せよ`という言葉で表されてる通り、現在の状態を正しく把握し、何がボトルネックになっているのか、
正しく判断し、対処することが肝要です。

## チューニングの目的

TODO: まず、何のためにチューニングするのか明確にする的なことを書く。やりすぎよくない的なことを書く

## 負荷をみる

現在の状態を見るために何はともあれ現在の負荷を確認します。

- ボトルネックになっているミドルウェアはどこか
- CPUバウンドなのか IOバウンドなのか

### 現在のスナップショットを見る

```sh
# ロードアベレージを見る
w
# プロセスを見る
ps -ef
# メモリを使ってるプロセスを見る
ps --sort=-%mem auxwww | head
# CPU使ってるプロセスを見る
ps --sort=-%cpu auxwww | head
```

### 継続的に現在の状態を見る

```sh
top
dstat -tamsl 5
mpstat -P ALL 5
```

### 過去の統計を見る
`sysstat`が入っていれば、`sar`コマンドで過去の負荷統計を確認することができます。

```sh
# CPU
sar -C
# Memry
sar -r
# Load average
sar -q
```

## ログを仕込む

TODO: appサーバのruntimeを記録する的なことを書く

TODO: MySQLのslow-logをちゃんと設定する的なことを書く

## チューニングの勘所

- アプリケーションコードの問題
- スキーマの問題
- クエリの問題
- インデックスの問題

のあたりを書く

## チューニング演習

TODO:

